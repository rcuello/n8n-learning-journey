# Instalación de n8n con NPM y exposición por Ngrok

## Introducción

En esta guía aprenderás a instalar **n8n** de forma local usando **Node.js y NPM**.
Esta opción es ideal para comenzar rápidamente, probar flujos en tu máquina personal y experimentar sin necesidad de configurar servidores en la nube.

Adicionalmente, aprenderás cómo **exponer tu instancia local de n8n a Internet usando Ngrok**, lo que permite probar webhooks y conexiones HTTPS de forma sencilla.

---

## Ventajas de esta configuración

* ✅ **Rápido y directo**: Instalación local sin necesidad de contenedores.
* ✅ **Entorno de desarrollo ideal**: Perfecto para aprender y hacer pruebas.
* ✅ **Compatible**: Funciona en Windows, macOS y Linux.
* ✅ **Ngrok**: Permite exponer tu instancia a Internet con HTTPS para probar integraciones externas.
* ⚠️ **Limitación**: No es recomendado para entornos de producción.

---

## Requisitos previos

* [Node.js](https://nodejs.org) versión **18 o superior**
* [npm](https://www.npmjs.com/) (incluido con Node.js)
* Una terminal (PowerShell, Git Bash o similar en Windows)
* [Ngrok](https://ngrok.com/) (para exponer localhost a Internet)

---

## Paso 1: Instalar n8n con NPM

### 1.1 Verificar Node.js y NPM

```bash
node -v
npm -v
```

Deberías ver versiones instaladas (ejemplo: `v20.x` para Node y `10.x` para npm).

### 1.2 Instalar n8n globalmente

```bash
npm install n8n -g
```

### 1.3 Verificar instalación

```bash
n8n --version
```

Deberías obtener el número de versión de n8n.

---

## Paso 2: Ejecutar n8n

En la terminal:

```bash
n8n
# o
n8n start
```

Esto iniciará el servidor local de n8n en:

```
http://localhost:5678
```

Abre el navegador y accede a esa dirección para usar la interfaz de n8n.

---

## Paso 3: Crear y configurar una cuenta en Ngrok

Antes de exponer n8n en Internet, es necesario contar con una **cuenta en Ngrok** y configurar un **authtoken** en tu máquina.

### 3.1 Registrarse en Ngrok

1. Ingresa a [https://ngrok.com](https://ngrok.com)
2. Haz clic en **Sign up**
3. Regístrate usando tu correo electrónico, cuenta de Google o GitHub
4. Una vez dentro, accederás al **Dashboard de Ngrok**

---

### 3.2 Obtener el authtoken

1. En el **Dashboard**, ve a la sección **Your Authtoken**
2. Copia el valor que aparece en pantalla (ejemplo: `2LRf9aC123ABCxYpQr...`)

---

### 3.3 Instalar Ngrok (si no lo has hecho)

* Descarga desde [ngrok.com/download](https://ngrok.com/download)
* Extrae y mueve el binario a una carpeta incluida en tu **PATH**
* Verifica instalación:

```bash
ngrok version
```

---

### 3.4 Configurar authtoken en tu máquina

En la terminal:

```bash
ngrok config add-authtoken TU_AUTHTOKEN_AQUI
```

Esto guardará el token en el archivo de configuración de Ngrok, normalmente ubicado en:

* **Linux/MacOS** → `~/.ngrok2/ngrok.yml`
* **Windows** → `C:\Users\TU_USUARIO\.ngrok2\ngrok.yml`

---

✅ Ahora tu instalación de Ngrok está lista para usarse.
En el siguiente paso expondremos el puerto **5678** de n8n al mundo con HTTPS.

---

## Paso 4: Exponer localhost con Ngrok

Muchas integraciones en n8n (ej. **webhooks**) requieren una URL accesible públicamente con HTTPS. Para esto, usaremos **Ngrok**.

### 4.1 Exponer el puerto de n8n (5678)

Ejecuta:

```bash
ngrok http 5678
```

Verás una salida similar a:

```
Forwarding    https://ab12-34-56-78.ngrok-free.app -> http://localhost:5678
```

👉 Usa la URL HTTPS generada (`https://...ngrok-free.app`) en tus integraciones externas.

---

## Paso 5: Configuración de n8n para usar Ngrok

En lugar de usar la URL `localhost`, configura n8n para reconocer la URL pública de Ngrok:

### 5.1 Definir variable de entorno

Ejecuta n8n con:

```bash
N8N_HOST=ab12-34-56-78.ngrok-free.app \
N8N_PORT=5678 \
N8N_PROTOCOL=https \
WEBHOOK_URL=https://ab12-34-56-78.ngrok-free.app \
n8n
```

### 5.2 Confirmar

* Abre la URL de Ngrok en el navegador para acceder a n8n.
* Los **webhooks** generados por n8n ahora usarán la URL pública de Ngrok.

---

## Paso 6: Uso típico en desarrollo

* 🚀 Ejecutar `n8n` en una terminal
* 🚀 En otra terminal, ejecutar `ngrok http 5678`
* 👉 Copiar la URL pública de Ngrok en tus integraciones externas

> 💡 **Tip**: Cada vez que reinicies Ngrok, la URL cambiará (a menos que tengas plan de pago).

---

## Solución de problemas

* **n8n no arranca** → Verifica que tienes Node.js 18+
* **Ngrok no expone la URL** → Asegúrate de que n8n está corriendo en el puerto 5678
* **Webhook no responde** → Confirma que configuraste `WEBHOOK_URL` correctamente

---

## Recursos adicionales

* [Documentación oficial de n8n](https://docs.n8n.io/)
* [Ngrok Documentation](https://ngrok.com/docs)
* [Comunidad n8n](https://community.n8n.io/)

---
