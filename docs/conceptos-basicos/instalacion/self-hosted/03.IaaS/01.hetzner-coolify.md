# Instalaci√≥n de n8n + PostgreSQL en Hetzner Cloud con Coolify 

## Introducci√≥n

Esta gu√≠a te mostrar√° c√≥mo desplegar **n8n** en un servidor de **Hetzner Cloud** utilizando [**Coolify**](https://coolify.io/).
Coolify es una plataforma de **PaaS open source** que permite desplegar aplicaciones f√°cilmente con Docker, manejar bases de datos, configurar HTTPS con Let‚Äôs Encrypt y administrar servicios desde una interfaz web.

Hetzner es ideal por su costo/beneficio, con planes econ√≥micos y escalables para entornos de producci√≥n peque√±os o medianos.

---

## Ventajas de usar Coolify

* ‚úÖ **Instalaci√≥n r√°pida**: sin necesidad de configurar Docker Compose manualmente
* ‚úÖ **Base de datos integrada**: puedes levantar PostgreSQL directamente desde la interfaz
* ‚úÖ **SSL autom√°tico**: certificados gratis con Let‚Äôs Encrypt
* ‚úÖ **Panel de control web**: administra servicios y contenedores f√°cilmente
* ‚úÖ **Escalable**: integra m√∫ltiples proyectos y servicios en el mismo servidor

---

## Requisitos previos

* Una cuenta en [Hetzner Cloud](https://www.hetzner.com/cloud)
* Una **SSH Key** configurada en tu cuenta de Hetzner
* Dominio propio apuntando a la IP p√∫blica del servidor (recomendado para HTTPS)

---

## Paso 1: Crear el servidor en Hetzner

1. Ingresa a tu [panel de Hetzner Cloud](https://console.hetzner.cloud/).

2. Haz clic en **"Add Server"**.

3. Configura:

   * **Location**: elige un datacenter cercano (ej. `Nuremberg` o `Ashburn`)
   ![Server location](./assets/hetzner-location.png)

   * **Image**: Ubuntu 22.04 LTS
   ![Server Image](./assets/hetzner-server-image.png)

   * **Type**: Shared VCPU `CX21` (3 vCPU `AMD`, 4 GB RAM, 80 GB SSD) ‚Äì suficiente para comenzar
   ![Server CPU Type](./assets/hetzner-cpu-type.png)

   * **Networking**: Public IPV4, Public IPV6
   ![Server Networking](./assets/hetzner-networking.png)

   * **SSH Key**: selecciona tu clave configurada previamente
   * **Server Name**: `n8n-server`

4. Crea el servidor y copia la IP p√∫blica generada.

![alt text](./assets/hetzner-server-created.png)

5. Reinicia la clave del usuario `root`.
![Restart root key](./assets/hetzner-restart-root-pwd.png)
---

## Paso 2: Conectarse al servidor

Desde tu terminal local:

```bash
ssh root@<IP_PUBLICA_HETZNER>
```

Ejemplo:

```bash
ssh root@65.21.123.45
```

Luego ingresa la contrase√±a del usuario root

```bash
root@65.21.123.45's password:
```

---
## Paso 3: Instalar Coolify

Ejecuta el script oficial [Self-hosted](https://coolify.io/self-hosted/) para instalar Coolify:

```bash
curl -fsSL https://cdn.coollabs.io/coolify/install.sh | bash
```

Una vez finalice la instalaci√≥n ver√°s un mensaje similar a:


![alt text](./assets/hetzner-coolify-install-success.png)


Luego de la instalaci√≥n , coolify te mostrarar√° un mensaje similar a :

```
Your instance is ready to use!

You can access Coolify through your Public IPV4: http://<IP_PUBLICA_HETZNER_V4>:8000
You can access Coolify through your Public IPv6: http://[<IP_PUBLICA_HETZNER_V6>]:8000

```

Luego accede desde tu navegador:

üëâ `http://<IP_PUBLICA_HETZNER_V4>:8000`

All√≠ podr√°s crear el usuario administrador y empezar la configuraci√≥n.

---

## Paso 4: Wizard para Crear la cuenta administrador en coolify
En la pantalla de bienvenida completa los datos para crear el usuario administrador:

![Coolify creating root user](./assets/hetzner-coolify-create-user.png)

Diligencia los datos del usuario administrador y luego ser√°s redirigido al panel principal:

![What is coolify panel](./assets/hetzner-coolify-onboarding-success.png)

Selecciona la opci√≥n que se desplegar√°n los recursos de un `servidor remoto`:

![Coolify onboarding set remove-server option](./assets/hetzner-coolify-onboarding-remote-server-option.png)

Selecciona que coolify cree un `SSH Private Key` por ti: 
![Coolify onboarding automatic ssh key generation](./assets/hetzner-coolify-onboarding-ssh-private-key.png)

Coolify genera private+public. Te mostrar√° la Public Key en la UI y te pedir√° ‚ÄúACTION REQUIRED: Copy the 'Public Key' to your server's ~/.ssh/authorized_keys file.‚Äù

Recomendado: deja generar la clave y copia la public key al servidor (mejor crear un usuario no-root y usar ese user).
![Coolify onboarding generate ssh key](./assets/hetzner-coolify-onboarding-create-ssh-key.png)

Para finalizar `skip on boarding`:
![Coolify skip onboarding](./assets/hetzner-coolify-onboarding-skip-onboarding.png)

---
## Paso 5: Crear proyecto en coolify y a√±adir n8n

1. Desde el **dashboard de Coolify**, haz clic en **"Create Project"**.
   Asigna un nombre (ejemplo: `n8n-prod`) y una descripci√≥n opcional.

   ![Coolify create project](./assets/hetzner-coolify-add-new-project.png) 

   ![Coolify set project name and description](./assets/hetzner-coolify-create-project.png)

2. Ingresa al proyecto y selecciona **"Add Resource"** ‚Üí **"Application"**.
   
3. Busca `N8N with Postgresql`:

   ![N8N with Postgresql resource](./assets/hetzner-coolify-add-resource.png)

## Paso 6: Guarda y despliega el proyecto

1. Haz clic en **"Save"** y luego en **"Deploy"**.
   Coolify descargar√° la imagen de **n8n con PostgreSQL**, levantar√° los contenedores y configurar√° el stack.

   ![Deploy n8n](./assets/hetzner-coolify-deploy-n8n.png)   

2. Una vez desplegado, podr√°s ver el estado en la pesta√±a **"Deployments"**:

   * Verde ‚úÖ ‚Üí todo correcto
   * Amarillo üü° ‚Üí iniciando
   * Rojo ‚ùå ‚Üí error (revisa los logs)

   ![Deployment Status](./assets/hetzner-coolify-deployment-status-success.png)

3. Para obtener la URL p√∫blica de tu instancia de n8n dirigete a los logs de coolify:

   ![Coolify get n8n editor ui url](./assets/hetzner-coolify-n8n-get-editor-ui-url.png)

   üëâ `http://n8n-w8w4kcgc8sowgkcg848wwg4w.<IP_PUBLICA_HETZNER_V4>.sslip.io/`

   ‚ö†Ô∏è Importante: por ahora est√° expuesto con la **IP p√∫blica**, sin HTTPS ni dominio.

4. En esta etapa, n8n puede mostrar un aviso de cookies inseguras si no est√° bajo HTTPS
   ```
   Your n8n server is configured to use a secure cookie,
   however you are either visiting this via an insecure URL, or using Safari.

   To fix this, please consider the following options:
   Setup TLS/HTTPS (recommended), or
   If you are running this locally, and not using Safari, try using localhost instead
   If you prefer to disable this security feature (not recommended), set the environment variable N8N_SECURE_COOKIE to false
   ```  
5. Para deshabilitar la validacion de cookie segurida debes configurar la variable de entorno `N8N_SECURE_COOKIE` a `false`:
   > Bajo tu responsabilidad: 

   ![Coolify how to disable secure cookie](./assets/hetzner-coolify-n8n-disabled-secure-cookie.png)  

6. Para tener n8n de manera segura lo resolveremos en el siguiente paso.  

## Paso 7: Configurar un subdominio en tu proveedor DNS

> ‚ö†Ô∏è Nota: Por defecto, Coolify asigna un dominio din√°mico de `sslip.io`. Esto funciona para pruebas r√°pidas, pero para producci√≥n es necesario configurar un subdominio propio, ya que `sslip.io` no genera certificados v√°lidos de Let's Encrypt en Coolify.

Para que tu instancia de n8n sea accesible de forma segura con HTTPS y un nombre amigable, lo ideal es usar un `subdominio` de tu dominio principal.

1. **Crea un registro DNS tipo A** en tu proveedor de dominios.
   Ejemplo:

   * Subdominio ‚Üí `sandbox.rocumentor.dev`
   * Tipo ‚Üí `A`
   * Valor ‚Üí `<IP_PUBLICA_HETZNER_V4>`

   (Opcional) agrega tambi√©n un registro `AAAA` si deseas soportar IPv6.

   ![DNS Config hostinger sample](./assets/hetzner-hostinger-dns-config.png)

2. **Verifica la propagaci√≥n del DNS** con:

   ```bash
   nslookup sandbox.rocumentor.dev
   ```

   Debe devolver la **IP p√∫blica de tu servidor en Hetzner**.

## Paso 8: Configurar el dominio en Coolify

1. En el **dashboard de Coolify**:

   * Entra a tu aplicaci√≥n `n8n`.
   * Ve a **Settings ‚Üí Domains**.
   * A√±ade el dominio: 
   ```
   https://sandbox.rocumentor.dev
   ```  

   ![Coolify domain](./assets/hetzner-coolify-set-domain.png)

   ![Coolify Update new domain](./assets/hetzner-coolify-update-domain.png)

---

## Paso 9: Ajustar variables de entorno de n8n

Para que n8n use correctamente tu subdominio, debes sincronizar las variables de entorno con el dominio configurado en Coolify.

En Coolify ‚Üí tu app `n8n` ‚Üí **Environment Variables**, elimina las variables de entorno:

```env
SERVICE_URL_N8N
SERVICE_FQDN_N8N
```

![Remove n8n env vars](./assets/hetzner-coolify-remove-env-vars.png)

Y agregalas nuevamente pero son los siguientes valores: 

```env
# Dominio p√∫blico (sin https://)
SERVICE_URL_N8N=sandbox.rocumentor.dev

# Dominio con protocolo (https://)
SERVICE_FQDN_N8N=https://sandbox.rocumentor.dev

```

![Upset n8n env vars](./assets/hetzner-coolify-set-env-vars.png)

Guarda los cambios y **redeploy**.

![Coolify restart server](./assets/hetzner-coolify-restart-server.png)
   
---

## Paso 10: Verificaci√≥n y acceso seguro

1. Ingresa en tu navegador:
   üëâ `https://sandbox.rocumentor.dev/`

2. Verifica que:

   * Se carga con **candado SSL**   
   * Los workflows se guardan correctamente en la base de datos PostgreSQL

   ![N8N subdomain success](./assets/hetzner-n8n-subdomain-success.png)

---

## Recursos adicionales

* [Documentaci√≥n oficial de n8n](https://docs.n8n.io/)
* [Hetzner Cloud Docs](https://docs.hetzner.com/cloud/)
* [Docker Compose Docs](https://docs.docker.com/compose/)
* [n8n Community](https://community.n8n.io/)


