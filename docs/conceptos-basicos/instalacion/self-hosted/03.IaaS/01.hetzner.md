# Instalaci√≥n de n8n en Hetzner Cloud con PostgreSQL

## Introducci√≥n

Esta gu√≠a te mostrar√° c√≥mo desplegar **n8n** en un servidor de **Hetzner Cloud** utilizando [**Coolify**](https://coolify.io/).
Coolify es una plataforma de **PaaS open source** que permite desplegar aplicaciones f√°cilmente con Docker, manejar bases de datos, configurar HTTPS con Let‚Äôs Encrypt y administrar servicios desde una interfaz web.

Hetzner es ideal por su costo/beneficio, con planes econ√≥micos y escalables para entornos de producci√≥n peque√±os o medianos.

---

## Ventajas de usar Coolify

* ‚úÖ **Instalaci√≥n r√°pida**: sin necesidad de configurar Docker Compose manualmente
* ‚úÖ **Base de datos integrada**: puedes levantar PostgreSQL directamente desde la interfaz
* ‚úÖ **SSL autom√°tico**: certificados gratis con Let‚Äôs Encrypt
* ‚úÖ **Panel de control web**: administra servicios y contenedores f√°cilmente
* ‚úÖ **Escalable**: integra m√∫ltiples proyectos y servicios en el mismo servidor

---

## Requisitos previos

* Una cuenta en [Hetzner Cloud](https://www.hetzner.com/cloud)
* Una **SSH Key** configurada en tu cuenta de Hetzner
* Dominio propio apuntando a la IP p√∫blica del servidor (recomendado para HTTPS)

---

## Paso 1: Crear el servidor en Hetzner

1. Ingresa a tu [panel de Hetzner Cloud](https://console.hetzner.cloud/).

2. Haz clic en **"Add Server"**.

3. Configura:

   * **Location**: elige un datacenter cercano (ej. `Nuremberg` o `Ashburn`)
   ![Server location](./assets/hetzner-location.png)

   * **Image**: Ubuntu 22.04 LTS
   ![Server Image](./assets/hetzner-server-image.png)

   * **Type**: Shared VCPU `CX21` (3 vCPU `AMD`, 4 GB RAM, 80 GB SSD) ‚Äì suficiente para comenzar
   ![Server CPU Type](./assets/hetzner-cpu-type.png)

   * **Networking**: Public IPV4, Public IPV6
   ![Server Networking](./assets/hetzner-networking.png)

   * **SSH Key**: selecciona tu clave configurada previamente
   * **Server Name**: `n8n-server`

4. Crea el servidor y copia la IP p√∫blica generada.

![alt text](./assets/hetzner-server-created.png)

5. Reinicia la clave del usuario `root`.
![Restart root key](./assets/hetzner-restart-root-pwd.png)
---

## Paso 2: Conectarse al servidor

Desde tu terminal local:

```bash
ssh root@<IP_PUBLICA_HETZNER>
```

Ejemplo:

```bash
ssh root@65.21.123.45
```

Luego ingresa la contrase√±a del usuario root

```bash
root@65.21.123.45's password:
```

---

## Paso 3: Instalar dependencias

Actualiza paquetes e instala Docker + Docker Compose:

```bash
apt update && apt upgrade -y
apt install -y docker.io docker-compose
systemctl enable docker
systemctl start docker
```

Verifica la instalaci√≥n:

```bash
docker --version
docker-compose --version
```

---

## Paso 4: Configurar base de datos PostgreSQL

En el mismo servidor usaremos PostgreSQL v√≠a Docker. Crea un archivo `docker-compose.yml`:

```yaml
version: '3.1'

services:
  postgres:
    image: postgres:15
    container_name: postgres_n8n
    restart: always
    environment:
      POSTGRES_USER: n8n
      POSTGRES_PASSWORD: superseguro123
      POSTGRES_DB: n8n_db
    volumes:
      - ./postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"

  n8n:
    image: docker.n8n.io/n8nio/n8n
    container_name: n8n_app
    restart: always
    ports:
      - "5678:5678"
    environment:
      - DB_TYPE=postgresdb
      - DB_POSTGRESDB_HOST=postgres
      - DB_POSTGRESDB_PORT=5432
      - DB_POSTGRESDB_DATABASE=n8n_db
      - DB_POSTGRESDB_USER=n8n
      - DB_POSTGRESDB_PASSWORD=superseguro123
      - N8N_HOST=tu-dominio.com
      - N8N_PORT=5678
      - N8N_PROTOCOL=https
      - WEBHOOK_URL=https://tu-dominio.com/
      - GENERIC_TIMEZONE=America/Bogota
    depends_on:
      - postgres
    volumes:
      - ./n8n_data:/home/node/.n8n
```

---

## Paso 5: Levantar los contenedores

Ejecuta:

```bash
docker-compose up -d
```

Verifica que todo est√© corriendo:

```bash
docker ps
```

---

## Paso 6: Configurar HTTPS (Nginx + Let‚Äôs Encrypt)

Para exponer n8n con HTTPS en tu dominio:

1. Instala Nginx y Certbot:

```bash
apt install -y nginx certbot python3-certbot-nginx
```

2. Configura un proxy inverso para n8n:

Archivo `/etc/nginx/sites-available/n8n.conf`:

```nginx
server {
    server_name tu-dominio.com;

    location / {
        proxy_pass http://localhost:5678;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

Activa el sitio:

```bash
ln -s /etc/nginx/sites-available/n8n.conf /etc/nginx/sites-enabled/
nginx -t
systemctl restart nginx
```

3. Genera certificado SSL:

```bash
certbot --nginx -d tu-dominio.com
```

Ahora n8n quedar√° disponible en:
üëâ `https://tu-dominio.com`

---

## Paso 7: Configuraci√≥n inicial de n8n

1. Ingresa a `https://tu-dominio.com`
2. Crea tu usuario administrador
3. Configura zona horaria y preferencias b√°sicas
4. Verifica que la base de datos PostgreSQL est√© conectada

---

## Paso 8: Seguridad y mantenimiento

* üîí **Firewall**: solo abre puertos 22 (SSH), 80 (HTTP) y 443 (HTTPS)
* üîë **Backups**: usa snapshots de Hetzner o haz `pg_dump` peri√≥dicos
* üöÄ **Actualizaciones**:

  ```bash
  docker-compose pull
  docker-compose up -d
  ```

---

## Soluci√≥n de problemas

* **n8n no arranca**: revisa `docker logs n8n_app`
* **Base de datos no conecta**: confirma usuario/contrase√±a y nombre del servicio en docker-compose
* **SSL falla**: verifica DNS de tu dominio hacia la IP de Hetzner

---

## Costos aproximados

* Hetzner Cloud CX11: **3 ‚Ç¨/mes**
* Dominio: **\~10 ‚Ç¨/a√±o**
* Certificado SSL: **Gratis con Let‚Äôs Encrypt**

---

## Recursos adicionales

* [Documentaci√≥n oficial de n8n](https://docs.n8n.io/)
* [Hetzner Cloud Docs](https://docs.hetzner.com/cloud/)
* [Docker Compose Docs](https://docs.docker.com/compose/)
* [n8n Community](https://community.n8n.io/)


