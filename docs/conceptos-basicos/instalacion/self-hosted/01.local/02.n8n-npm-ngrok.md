# Instalaci√≥n de n8n con NPM y exposici√≥n por Ngrok

## Introducci√≥n

En esta gu√≠a aprender√°s a instalar **n8n** de forma local usando **Node.js y NPM**.
Esta opci√≥n es ideal para comenzar r√°pidamente, probar flujos en tu m√°quina personal y experimentar sin necesidad de configurar servidores en la nube.

Adicionalmente, aprender√°s c√≥mo **exponer tu instancia local de n8n a Internet usando Ngrok**, lo que permite probar webhooks y conexiones HTTPS de forma sencilla.

---

## Ventajas de esta configuraci√≥n

* ‚úÖ **R√°pido y directo**: Instalaci√≥n local sin necesidad de contenedores.
* ‚úÖ **Entorno de desarrollo ideal**: Perfecto para aprender y hacer pruebas.
* ‚úÖ **Compatible**: Funciona en Windows, macOS y Linux.
* ‚úÖ **Ngrok**: Permite exponer tu instancia a Internet con HTTPS para probar integraciones externas.
* ‚ö†Ô∏è **Limitaci√≥n**: No es recomendado para entornos de producci√≥n.

---

## Requisitos previos

* [Node.js](https://nodejs.org) versi√≥n **18 o superior**
* [npm](https://www.npmjs.com/) (incluido con Node.js)
* Una terminal (PowerShell, Git Bash o similar en Windows)
* [Ngrok](https://ngrok.com/) (para exponer localhost a Internet)

---

### üîé Verificaci√≥n adicional si usas NVM

Si tienes instalado **NVM** (Node Version Manager) en :
* [Windows](https://github.com/coreybutler/nvm-windows)
* [Linux](https://github.com/nvm-sh/nvm)

Aseg√∫rate de que la versi√≥n activa de Node.js es **18 o superior**.

```bash
nvm list
```

Ver√°s algo como:

```
    16.20.0
->  18.17.1
    20.11.0
```

El s√≠mbolo `->` indica la versi√≥n activa.

---

#### ‚úÖ Si ya tienes Node.js 18+

No necesitas hacer nada m√°s.

---

#### ‚ö° Si tienes una versi√≥n anterior

Instala y usa la versi√≥n adecuada con NVM:

```bash
# Instalar la versi√≥n recomendada
nvm install 20

# Activar la versi√≥n instalada
nvm use 20

# Opcional: establecerla como predeterminada
nvm alias default 20
```

Confirma que ahora la versi√≥n activa es la correcta:

```bash
node -v
```

Deber√≠a mostrar algo como `v18.x` o `v20.x`.

---

## Paso 1: Instalar n8n con NPM

### 1.1 Verificar Node.js y NPM

```bash
node -v
npm -v
```

Deber√≠as ver versiones instaladas (ejemplo: `v20.x` para Node y `10.x` para npm).

### 1.2 Instalar n8n globalmente

```bash
npm install n8n -g
```

> ‚ö†Ô∏è **Soluci√≥n de problemas en Windows**: Si al intentar ejecutar `n8n` obtienes el error `'n8n' no se reconoce...`, significa que la ruta de instalaci√≥n global de NPM no est√° en tu variable de entorno **PATH**. Para solucionarlo, debes agregarla manualmente.

#### **Configurar la variable de entorno PATH**

1.  Abre el **S√≠mbolo del sistema** o **PowerShell** **como administrador**.

2.  Ejecuta el siguiente comando para abrir la ventana de configuraci√≥n de variables de entorno:

    ```bash
    rundll32.exe sysdm.cpl,EditEnvironmentVariables
    ```

3.  En la ventana que se abre, busca la variable **`Path`** en la secci√≥n "Variables de usuario" o "Variables del sistema", selecci√≥nala y haz clic en **"Editar..."**.

    ![alt text](./assets/n8n-sysdm-cpl-edit-path.png)

4.  Haz clic en **"Nuevo"** y pega la ruta donde NPM instala los paquetes globales. Si no est√°s seguro de cu√°l es la ruta, puedes obtenerla ejecutando el siguiente comando:

    ```bash
    npm config get prefix
    ```
    Generalmente, la ruta es similar a `C:\Users\TU_USUARIO\AppData\Roaming\npm`.

5.  Haz clic en **Aceptar** en todas las ventanas para guardar los cambios.

6.  **Cierra y vuelve a abrir tu terminal** para que los cambios surtan efecto. Ahora, el comando `n8n` deber√≠a ser reconocido.

-----

### 1.3 Verificar instalaci√≥n

```bash
n8n --version
```

Deber√≠as obtener el n√∫mero de versi√≥n de n8n.

---

## Paso 2: Ejecutar n8n

En la terminal:

```bash
n8n
# o
n8n start
```

Esto iniciar√° el servidor local de n8n en:

```
http://localhost:5678
```

Abre el navegador y accede a esa direcci√≥n para usar la interfaz de n8n.

---

## Paso 3: Crear y configurar una cuenta en Ngrok

Antes de exponer n8n en Internet, es necesario contar con una **cuenta en Ngrok** como proxy revertido y configurar un **authtoken** en tu m√°quina.

### 3.1 Registro en Ngrok

1. Ingresa a [https://ngrok.com](https://ngrok.com)
2. Haz clic en [**Sign up**](https://dashboard.ngrok.com/signup)
3. Reg√≠strate usando tu correo electr√≥nico, cuenta de Google o GitHub

![ngrok Signup](./assets/n8n-npm-ngrok-signup.png)

### 3.2 Aceptar t√©rminos y condiciones
1. Durante el registro, Ngrok te pedir√° aceptar los **T√©rminos de Servicio** y la **Pol√≠tica de Privacidad**.
2. Marca la casilla correspondiente antes de continuar.

![alt text](./assets/n8n-npm-ngrok-terminos-condiciones.png) 

## 3.3 Configuraci√≥n de MFA (Opcional pero recomendado)

1. Tras el registro, tendr√°s la opci√≥n de configurar **Multi-Factor Authentication (MFA)**.
2. Ngrok soporta aplicaciones como Google Authenticator, Authy o Microsoft Authenticator.
3. Si decides configurarlo:

  1. Escanea el QR en tu app de autenticaci√≥n.
  2. Ingresa el c√≥digo de verificaci√≥n generado.
4. Si no deseas activarlo, puedes saltar este paso y configurarlo m√°s adelante desde el perfil.

## 3.4 Onboarding en Ngrok

1. Despu√©s de la verificaci√≥n, Ngrok te redirige a un breve **formulario de onboarding** donde debes indicar:
* **C√≥mo te describes:** (ej. *Software Architect*, *Developer*, *Student*).
* **Qu√© te interesa usar de Ngrok:**

Ejemplo de pantalla del formulario de onboarding:

![ngrok onboarding](./assets/n8n-npm-ngrok-onboarding.png)

## 3.5 Dashboard en Ngrok
1. Una vez dentro, acceder√°s al [Dashboard de Ngrok](https://dashboard.ngrok.com/get-started/setup/windows)

![ngrok dashboard](./assets/n8n-npm-ngrok-dashboard.png)

---

### Paso 4: Instalar Ngrok en Windows

Ya que trabajaremos sobre **Windows**, sigue estos pasos:

### 4.1 Descargar Ngrok

1. Ingresa a [https://dashboard.ngrok.com/get-started/setup/windows](https://dashboard.ngrok.com/get-started/setup/windows)
2. Selecciona la pesta√±a **Download**
3. Descarga el ejecutable para tu arquitectura (generalmente **64-bit**)

![ngrok Windows Download](./assets/n8n-npm-ngrok-windows-download.png)

### 4.2 Instalar Ngrok

1. Extrae el archivo `.zip` descargado
2. Mueve el ejecutable `ngrok.exe` a una carpeta incluida en tu **PATH**, por ejemplo:

   ```
   C:\Users\TU_USUARIO\AppData\Local\Microsoft\WindowsApps
   ```
3. Verifica instalaci√≥n desde PowerShell:

```powershell
ngrok version
```

Deber√≠as ver la versi√≥n instalada.

---

## Paso 5: Configurar el authtoken en Windows

1. En el **Dashboard**, copia tu authtoken desde la secci√≥n **Your Authtoken**.

![ngrok auth token](./assets/n8n-ngrok-dashboard-auth-token.png)

2. En la terminal de Windows (PowerShell), ejecuta:

```powershell
ngrok config add-authtoken TU_AUTHTOKEN_AQUI
```

Esto guardar√° el token en el archivo de configuraci√≥n de Ngrok, normalmente ubicado en:

* **Linux/MacOS** ‚Üí `~/.ngrok2/ngrok.yml`
* **Windows** ‚Üí `C:\Users\TU_USUARIO\.ngrok2\ngrok.yml`

---

‚úÖ Ahora tu instalaci√≥n de Ngrok est√° lista para usarse.
En el siguiente paso expondremos el puerto **5678** de n8n al mundo con HTTPS.

---

## Paso 6: Exponer localhost con Ngrok

Muchas integraciones en n8n (ej. **webhooks**) requieren una URL accesible p√∫blicamente con HTTPS. Para esto, usaremos **Ngrok**.

### 6.1 Exponer el puerto de n8n (5678)

Ejecuta:

```bash
ngrok http 5678
```

Ver√°s una salida similar a:

```
Session Status                online                                                                                                 Account                       **************** (Plan: Free)                                                                    Version                       3.26.0                                                                                                 Region                        United States (us)                                                                                     Latency                       82ms                                                                                                   Web Interface                     http://127.0.0.1:4040
Forwarding                    https://ab12-34-56-78.ngrok-free.app -> http://localhost:5678
```

## Paso 7: Acceder y validar la URL p√∫blica generada por Ngrok

Una vez que ejecutes el comando `ngrok http 5678`, Ngrok generar√° una **URL p√∫blica con HTTPS** que apunta a tu instancia local de n8n.

### 7.1 Confirmar la URL

En la salida de la terminal, identifica el valor en la columna **Forwarding**:

```
Forwarding   https://ab12-34-56-78.ngrok-free.app -> http://localhost:5678
```

Esa ser√° la direcci√≥n p√∫blica que deber√°s usar en navegadores o integraciones externas.

---

### 7.2 Primera visita: advertencia de seguridad

Cuando abras la URL en tu navegador, Ngrok te mostrar√° una **advertencia de seguridad** recordando que est√°s exponiendo un servicio local a Internet:

![ngrok warning](./assets/n8n-ngrok-webbrowser-warning.png)

Haz clic en **Visit Site** para continuar.

---

### 7.3 Validar n8n desde la URL p√∫blica

Si todo funciona correctamente, deber√≠as ver la interfaz de **n8n** cargando desde la direcci√≥n p√∫blica:

![ngrok tunnel to localhost](./assets/n8n-ngrok-tunnel-localhost.png)

En este punto, tu instancia ya est√° accesible desde cualquier lugar en Internet mediante la URL de Ngrok.


---

### 7.4 Precauci√≥n de seguridad ‚ö†Ô∏è

* La URL de Ngrok expone tu **instancia de n8n al mundo**, incluso con plan gratuito.
* Evita usar credenciales reales o informaci√≥n sensible en este modo.
* Para mayor seguridad:

  * Limita el tiempo que Ngrok est√° activo.
  * Configura autenticaci√≥n en n8n antes de exponerlo.

---

üëâ Con esto ya validaste que tu n8n es accesible globalmente. El siguiente paso es **configurar n8n para que use esta URL p√∫blica en sus webhooks** .

---

## Paso 8: Ejecutar n8n con Ngrok

Existen dos formas de ejecutar n8n con Ngrok: **definiendo variables en cada sesi√≥n** o usando un archivo `.env`.

### 8.1 Variables de entorno temporales (PowerShell)

Ejecuta en la misma terminal donde abriste Ngrok:

```powershell
$env:N8N_HOST="ab12-34-56-78.ngrok-free.app"
$env:N8N_PORT="5678"
$env:N8N_PROTOCOL="https"
$env:WEBHOOK_URL="https://ab12-34-56-78.ngrok-free.app"

n8n
```

‚ö†Ô∏è Ten en cuenta: Si cierras la terminal, deber√°s volver a definir estas variables.

### 8.2  Usando archivo `.env`

1. Crea un archivo `.env` en tu carpeta de trabajo:

```
N8N_HOST=ab12-34-56-78.ngrok-free.app
N8N_PORT=5678
N8N_PROTOCOL=https
WEBHOOK_URL=https://ab12-34-56-78.ngrok-free.app
```

2. Instala dotenv-cli (si no lo tienes):

```bash
npm install -g dotenv-cli
```

3. Ejecuta n8n cargando las variables:

```bash
dotenv -e .env -- n8n
```

---


### 8.2 Confirmar

* Abre la URL de Ngrok en el navegador para acceder a n8n.
* Los **webhooks** generados por n8n ahora usar√°n la URL p√∫blica de Ngrok.
---



## Paso 9: Persistencia de Datos

* Toda la configuraci√≥n y workflows de n8n se guardan en:

  * **Linux/Mac**: `~/.n8n/`
  * **Windows**: `%USERPROFILE%\.n8n\`

As√≠, aunque reinstales n8n, no perder√°s tu trabajo.

---

## Paso 10: Alternativa con Docker

Para un entorno m√°s cercano a producci√≥n:
üëâ [Documentaci√≥n oficial de n8n con Docker](https://docs.n8n.io/hosting/installation/docker/)

---

## Soluci√≥n de problemas

* **n8n no arranca** ‚Üí Verifica que tienes Node.js 18+
* **Ngrok no expone la URL** ‚Üí Aseg√∫rate de que n8n est√° corriendo en el puerto 5678
* **Webhook no responde** ‚Üí Confirma que configuraste `WEBHOOK_URL` correctamente

---

## Recursos adicionales

* [Documentaci√≥n oficial de n8n](https://docs.n8n.io/)
* [Ngrok Documentation](https://ngrok.com/docs)
* [Comunidad n8n](https://community.n8n.io/)
* [Node Version Manager](https://github.com/nvm-sh/nvm)
* [NVM for Windows](https://github.com/coreybutler/nvm-windows)

---
