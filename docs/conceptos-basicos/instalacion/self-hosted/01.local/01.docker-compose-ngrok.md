

# Instalaci√≥n de n8n con Docker Compose y exposici√≥n mediante Ngrok

Este documento explica c√≥mo instalar y ejecutar **n8n en un entorno Docker local** usando `docker-compose`, junto con servicios auxiliares como **PostgreSQL, Redis, Adminer y Mitmproxy**.
Adem√°s, aprender√°s a exponer n8n de forma segura en Internet usando **Ngrok**.

---

## 1. Requisitos Previos

* [Docker Desktop](https://www.docker.com/products/docker-desktop/) instalado.
* [Ngrok](https://ngrok.com/) instalado y configurado con tu **authtoken**.
* Editor de texto para modificar archivos (`.env`, `docker-compose.yml`).

---

## 2. Crear una cuenta en Ngrok

1. Ingresa a [https://ngrok.com](https://ngrok.com).
2. Reg√≠strate con correo, GitHub o Google.
3. Acepta los **t√©rminos y condiciones**.
4. (Opcional) Configura **MFA** para mayor seguridad.
5. Completa el formulario de **onboarding**.
6. Copia tu **authtoken** desde el panel en:
   üëâ *Dashboard ‚Üí Your Authtoken*.

Configura el authtoken en tu sistema:

```bash
ngrok config add-authtoken TU_AUTHTOKEN
```

---

## 3. Preparar el entorno de trabajo

1. Crea una carpeta de proyecto:

   ```bash
   mkdir n8n-docker && cd n8n-docker
   ```

2. Copia el archivo `docker-compose.yml` proporcionado.

3. Crea un archivo `.env` en la ra√≠z con valores como:

   ```env
   # n8n
   N8N_HOST=localhost
   N8N_PORT=5678
   N8N_PROTOCOL=http
   WEBHOOK_URL=http://localhost:5678
   GENERIC_TIMEZONE=America/Bogota
   TZ=America/Bogota

   # UI
   N8N_BASIC_AUTH_ACTIVE=true
   N8N_UI_USER=admin
   N8N_UI_PASSWORD=admin123

   # PostgreSQL
   POSTGRES_DB=n8n
   POSTGRES_USER=n8n_user
   POSTGRES_PASSWORD=n8n_pass

   # Redis
   REDIS_PASSWORD=redis_pass
   REDIS_PORT=6379

   # Mitmproxy
   MITMPROXY_PORT=8081
   MITMPROXY_WEB_PORT=8082
   MITMPROXY_WEB_PASSWORD=proxy123

   # Adminer
   ADMINER_PORT=8080

   # Logs
   N8N_LOG_LEVEL=info
   N8N_LOG_OUTPUT=console
   CODE_ENABLE_STDOUT=true

   # Proxy (solo demostrativo, no producci√≥n)
   NODE_TLS_REJECT_UNAUTHORIZED=0
   HTTP_PROXY=
   HTTPS_PROXY=
   NO_PROXY=localhost,127.0.0.1
   ```

---

## 4. Levantar el entorno con Docker Compose

### Iniciar contenedores

```bash
docker-compose up -d
```

### Detener contenedores

```bash
docker-compose down
```

### Ver logs

```bash
docker-compose logs -f
```

### Acceder a un contenedor

```bash
docker-compose exec n8n sh
```

---

## 5. Exponer n8n con Ngrok

1. En una terminal separada, inicia Ngrok hacia el puerto configurado de n8n:

   ```bash
   ngrok http 5678
   ```

2. Obtendr√°s una URL p√∫blica similar a:

   ```
   https://ab12-34-56-78.ngrok-free.app
   ```

3. Copia esa URL y actualiza en tu `.env`:

   ```env
   N8N_HOST=ab12-34-56-78.ngrok-free.app
   N8N_PROTOCOL=https
   WEBHOOK_URL=https://ab12-34-56-78.ngrok-free.app
   N8N_EDITOR_BASE_URL=https://ab12-34-56-78.ngrok-free.app
   ```

4. Reinicia n8n:

   ```bash
   docker-compose down
   docker-compose up -d
   ```

---

## 6. Acceso a los servicios

* **n8n Editor UI** ‚Üí `https://<tu-url-ngrok>`
* **Ngrok Dashboard** ‚Üí [http://127.0.0.1:4040](http://127.0.0.1:4040)
* **Adminer (gesti√≥n DB)** ‚Üí [http://localhost:8080](http://localhost:8080)
* **Mitmproxy UI** ‚Üí [http://localhost:8082](http://localhost:8082) (usuario/contrase√±a en `.env`)
* **Redis** ‚Üí Disponible en `localhost:${REDIS_PORT}`

---

## 7. Recomendaciones de Seguridad

* Cambia todas las contrase√±as por defecto en `.env`.
* No uses este stack directamente en producci√≥n.
* Considera certificados SSL y un proxy inverso (ej. Traefik o Nginx) para ambientes reales.

---

## 8. Persistencia de Datos

* **n8n data** ‚Üí `./.docker-volume/n8n_data/`
* **PostgreSQL** ‚Üí volumen `postgres_data`
* **Redis** ‚Üí volumen `redis_data`
* **Mitmproxy certs** ‚Üí `./.docker-volume/mitmproxy_certs/`

Esto asegura que los datos persistan aunque reinicies o recrees los contenedores.

---

‚úÖ Con esto tienes un **entorno de laboratorio completo con n8n, base de datos, cach√©, proxy y exposici√≥n a Internet con Ngrok**.

---
