# Instalación de n8n con NPM y exposición por Ngrok

## Introducción

En esta guía aprenderás a instalar **n8n** de forma local usando **Node.js y NPM**.
Esta opción es ideal para comenzar rápidamente, probar flujos en tu máquina personal y experimentar sin necesidad de configurar servidores en la nube.

Adicionalmente, aprenderás cómo **exponer tu instancia local de n8n a Internet usando Ngrok**, lo que permite probar webhooks y conexiones HTTPS de forma sencilla.

---

## Ventajas de esta configuración

* ✅ **Rápido y directo**: Instalación local sin necesidad de contenedores.
* ✅ **Entorno de desarrollo ideal**: Perfecto para aprender y hacer pruebas.
* ✅ **Compatible**: Funciona en Windows, macOS y Linux.
* ✅ **Ngrok**: Permite exponer tu instancia a Internet con HTTPS para probar integraciones externas.
* ⚠️ **Limitación**: No es recomendado para entornos de producción.

---

## Requisitos previos

* [Node.js](https://nodejs.org) versión **18 o superior**
* [npm](https://www.npmjs.com/) (incluido con Node.js)
* Una terminal (PowerShell, Git Bash o similar en Windows)
* [Ngrok](https://ngrok.com/) (para exponer localhost a Internet)

---

## Paso 1: Instalar n8n con NPM

### 1.1 Verificar Node.js y NPM

```bash
node -v
npm -v
```

Deberías ver versiones instaladas (ejemplo: `v20.x` para Node y `10.x` para npm).

### 1.2 Instalar n8n globalmente

```bash
npm install n8n -g
```

> ⚠️ **Solución de problemas en Windows**: Si al intentar ejecutar `n8n` obtienes el error `'n8n' no se reconoce...`, significa que la ruta de instalación global de NPM no está en tu variable de entorno **PATH**. Para solucionarlo, debes agregarla manualmente.

#### **Configurar la variable de entorno PATH**

1.  Abre el **Símbolo del sistema** o **PowerShell** **como administrador**.

2.  Ejecuta el siguiente comando para abrir la ventana de configuración de variables de entorno:

    ```bash
    rundll32.exe sysdm.cpl,EditEnvironmentVariables
    ```

3.  En la ventana que se abre, busca la variable **`Path`** en la sección "Variables de usuario" o "Variables del sistema", selecciónala y haz clic en **"Editar..."**.

    ![alt text](./assets/n8n-sysdm-cpl-edit-path.png)

4.  Haz clic en **"Nuevo"** y pega la ruta donde NPM instala los paquetes globales. Si no estás seguro de cuál es la ruta, puedes obtenerla ejecutando el siguiente comando:

    ```bash
    npm config get prefix
    ```
    Generalmente, la ruta es similar a `C:\Users\TU_USUARIO\AppData\Roaming\npm`.

5.  Haz clic en **Aceptar** en todas las ventanas para guardar los cambios.

6.  **Cierra y vuelve a abrir tu terminal** para que los cambios surtan efecto. Ahora, el comando `n8n` debería ser reconocido.

-----

### 1.3 Verificar instalación

```bash
n8n --version
```

Deberías obtener el número de versión de n8n.

---

## Paso 2: Ejecutar n8n

En la terminal:

```bash
n8n
# o
n8n start
```

Esto iniciará el servidor local de n8n en:

```
http://localhost:5678
```

Abre el navegador y accede a esa dirección para usar la interfaz de n8n.

---

## Paso 3: Crear y configurar una cuenta en Ngrok

Antes de exponer n8n en Internet, es necesario contar con una **cuenta en Ngrok** como proxy revertido y configurar un **authtoken** en tu máquina.

### 3.1 Registro en Ngrok

1. Ingresa a [https://ngrok.com](https://ngrok.com)
2. Haz clic en [**Sign up**](https://dashboard.ngrok.com/signup)
3. Regístrate usando tu correo electrónico, cuenta de Google o GitHub

![ngrok Signup](./assets/n8n-npm-ngrok-signup.png)

### 3.2 Aceptar términos y condiciones
1. Durante el registro, Ngrok te pedirá aceptar los **Términos de Servicio** y la **Política de Privacidad**.
2. Marca la casilla correspondiente antes de continuar.

![alt text](./assets/n8n-npm-ngrok-terminos-condiciones.png) 

## 3.3 Configuración de MFA (Opcional pero recomendado)

1. Tras el registro, tendrás la opción de configurar **Multi-Factor Authentication (MFA)**.
2. Ngrok soporta aplicaciones como Google Authenticator, Authy o Microsoft Authenticator.
3. Si decides configurarlo:

  1. Escanea el QR en tu app de autenticación.
  2. Ingresa el código de verificación generado.
4. Si no deseas activarlo, puedes saltar este paso y configurarlo más adelante desde el perfil.

## 3.4 Onboarding en Ngrok

1. Después de la verificación, Ngrok te redirige a un breve **formulario de onboarding** donde debes indicar:
* **Cómo te describes:** (ej. *Software Architect*, *Developer*, *Student*).
* **Qué te interesa usar de Ngrok:**

Ejemplo de pantalla del formulario de onboarding:

![ngrok onboarding](./assets/n8n-npm-ngrok-onboarding.png)

## 3.5 Dashboard en Ngrok
1. Una vez dentro, accederás al [Dashboard de Ngrok](https://dashboard.ngrok.com/get-started/setup/windows)

![ngrok dashboard](./assets/n8n-npm-ngrok-dashboard.png)

---

### Paso 4: Instalar Ngrok en Windows

Ya que trabajaremos sobre **Windows**, sigue estos pasos:

### 4.1 Descargar Ngrok

1. Ingresa a [https://dashboard.ngrok.com/get-started/setup/windows](https://dashboard.ngrok.com/get-started/setup/windows)
2. Selecciona la pestaña **Download**
3. Descarga el ejecutable para tu arquitectura (generalmente **64-bit**)

![ngrok Windows Download](./assets/n8n-npm-ngrok-windows-download.png)

### 4.2 Instalar Ngrok

1. Extrae el archivo `.zip` descargado
2. Mueve el ejecutable `ngrok.exe` a una carpeta incluida en tu **PATH**, por ejemplo:

   ```
   C:\Users\TU_USUARIO\AppData\Local\Microsoft\WindowsApps
   ```
3. Verifica instalación desde PowerShell:

```powershell
ngrok version
```

Deberías ver la versión instalada.

---

## Paso 5: Configurar el authtoken en Windows

1. En el **Dashboard**, copia tu authtoken desde la sección **Your Authtoken**.

![ngrok auth token](./assets/n8n-ngrok-dashboard-auth-token.png)

2. En la terminal de Windows (PowerShell), ejecuta:

```powershell
ngrok config add-authtoken TU_AUTHTOKEN_AQUI
```

Esto guardará el token en el archivo de configuración de Ngrok, normalmente ubicado en:

* **Linux/MacOS** → `~/.ngrok2/ngrok.yml`
* **Windows** → `C:\Users\TU_USUARIO\.ngrok2\ngrok.yml`

---

✅ Ahora tu instalación de Ngrok está lista para usarse.
En el siguiente paso expondremos el puerto **5678** de n8n al mundo con HTTPS.

---

## Paso 6: Exponer localhost con Ngrok

Muchas integraciones en n8n (ej. **webhooks**) requieren una URL accesible públicamente con HTTPS. Para esto, usaremos **Ngrok**.

### 6.1 Exponer el puerto de n8n (5678)

Ejecuta:

```bash
ngrok http 5678
```

Verás una salida similar a:

```
Session Status                online                                                                                                 Account                       **************** (Plan: Free)                                                                    Version                       3.26.0                                                                                                 Region                        United States (us)                                                                                     Latency                       82ms                                                                                                   Web Interface                     http://127.0.0.1:4040
Forwarding                    https://ab12-34-56-78.ngrok-free.app -> http://localhost:5678
```

### 6.2 Navega la URL expuesta por ngrok

![ngrok warning](./assets/n8n-ngrok-webbrowser-warning.png)

![ngrok tunnel to localhost](./assets/n8n-ngrok-tunnel-localhost.png)

---

## Paso 7: Configuración de n8n para usar Ngrok

👉 Usa la URL HTTPS generada (`https://...ngrok-free.app`) en tus integraciones externas.

En lugar de usar la URL `localhost`, configura n8n para reconocer la URL pública de Ngrok:

### 7.1 Definir variable de entorno

Ejecuta n8n con:

```bash
N8N_HOST=ab12-34-56-78.ngrok-free.app \
N8N_PORT=5678 \
N8N_PROTOCOL=https \
WEBHOOK_URL=https://ab12-34-56-78.ngrok-free.app \
n8n
```

### 7.2 Confirmar

* Abre la URL de Ngrok en el navegador para acceder a n8n.
* Los **webhooks** generados por n8n ahora usarán la URL pública de Ngrok.

---

## Paso 8: Uso típico en desarrollo

* 🚀 Ejecutar `n8n` en una terminal
* 🚀 En otra terminal, ejecutar `ngrok http 5678`
* 👉 Copiar la URL pública de Ngrok en tus integraciones externas

> 💡 **Tip**: Cada vez que reinicies Ngrok, la URL cambiará (a menos que tengas plan de pago).

---

## Solución de problemas

* **n8n no arranca** → Verifica que tienes Node.js 18+
* **Ngrok no expone la URL** → Asegúrate de que n8n está corriendo en el puerto 5678
* **Webhook no responde** → Confirma que configuraste `WEBHOOK_URL` correctamente

---

## Recursos adicionales

* [Documentación oficial de n8n](https://docs.n8n.io/)
* [Ngrok Documentation](https://ngrok.com/docs)
* [Comunidad n8n](https://community.n8n.io/)

---
